import{f as p,a5 as ae,k as u,l as i,n as e,a6 as Q,q as m,i as W,S as h,z as w,Q as X,p as C,R as b,A as $,_ as oe,w as g,P as U,M as ie,m as ne,e as de,s as H,o as re,T as ce,a7 as ue,t as A,F as J,N as me,a8 as be,a9 as ve,aa as K,ab as pe,u as ge,ac as fe}from"./index-ChJtxUgM.js";import{_ as ye}from"./AlertModal-B7QNiGTe.js";import{_ as ke}from"./PaginationComponent-C3-PPg9j.js";import{t as xe}from"./tagAndCategoryStore-BMI8q0zC.js";const he={class:"modal-dialog modal-dialog-centered"},_e={class:"modal-content overflow-hidden"},$e={class:"modal-body p-0"},Ce={class:"d-flex p-11"},we={class:"flex-fill"},Me={class:"modal-title mb-8 h4",id:"delModalLabel"},Re={class:"mb-8"},Ie={class:"d-flex justify-content-end px-11 py-8 bg-light"},Le={__name:"DelModal",props:{delId:{type:String,default:""}},setup(l,{expose:f}){const s=p(null),{openModal:v,hideModal:y}=ae(s);return f({openModal:v,hideModal:y}),(d,r)=>(i(),u("div",{class:"modal fade",id:"delModal",tabindex:"-1","aria-labelledby":"delModalLabel","data-bs-backdrop":"static","data-bs-keyboard":"false",ref_key:"delModalRef",ref:s},[e("div",he,[e("div",_e,[e("div",$e,[e("div",Ce,[r[4]||(r[4]=e("span",{class:"titleIcon bg-danger-subtle text-danger"},[e("i",{class:"bi bi-x-lg"})],-1)),e("div",we,[e("h1",Me,[Q(d.$slots,"modal-header",{},()=>[r[1]||(r[1]=m("標題"))])]),e("div",Re,[Q(d.$slots,"modal-content",{},()=>[r[2]||(r[2]=m("內容"))])]),r[3]||(r[3]=e("p",{class:"text-muted"},"注意：刪除後無法復原",-1))])]),e("div",Ie,[r[5]||(r[5]=e("button",{type:"button",class:"btn btn-sm btn-outline-primary me-8","data-bs-dismiss":"modal"}," 關閉 ",-1)),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:r[0]||(r[0]=j=>d.$emit("del-item",l.delId))}," 確定刪除 ")])])])])],512))}},Pe={class:"d-flex flex-column flex-md-row position-relative mb-12 p-11 bg-white rounded-2 shadow-sm"},Se={key:0,class:"cardVerticalCollect d-block"},Ve={key:1,class:"cardVerticalCollect d-block"},Be={class:"flex-fill text-center text-md-start"},De={class:"d-inline-block mb-8 px-6 py-2 bg-secondary rounded-2 text-white"},Ne={class:"mb-2"},Te={class:"textClamp textClampSm textLsSm mb-8 text-muted overflow-hidden"},Ae={class:"text-center text-md-end"},Ue={__name:"CardVerticalComponent",props:{recipe:{type:Object,default(){return{}}},categories:{type:Object,default(){return[]}},tags:{type:Object,default(){return[]}},status:{type:String,default:""},collects:{type:Array,default(){return[]}},mode:{type:String,default:"collect"}},setup(l){return(f,s)=>{var y;const v=W("router-link");return i(),u("div",Pe,[l.mode==="collect"?(i(),u("div",Se,[l.collects.includes(l.recipe._id)?(i(),u("a",{key:0,href:"#",class:"cardVerticalCollectBtn d-block px-6 py-4 rounded-circle text-danger",onClick:s[0]||(s[0]=w(d=>f.$emit("toggle-collect",{active:"remove",recipeId:l.recipe._id}),["prevent"]))},s[3]||(s[3]=[e("i",{class:"bi bi-heart-fill"},null,-1)]))):(i(),u("a",{key:1,href:"#",class:"cardVerticalCollectBtn d-block px-6 py-4 rounded-circle",onClick:s[1]||(s[1]=w(d=>f.$emit("toggle-collect",{active:"create",recipeId:l.recipe._id}),["prevent"]))},s[4]||(s[4]=[e("i",{class:"bi bi-heart"},null,-1)])))])):h("",!0),l.mode!=="collect"?(i(),u("div",Ve,[e("a",{href:"#",class:"cardVerticalDelBtn d-block px-6 py-4 rounded-circle text-white",onClick:s[2]||(s[2]=w(d=>f.$emit("open-del-modal",{recipeId:l.recipe._id,recipeTitle:l.recipe.title}),["prevent"]))},s[5]||(s[5]=[e("i",{class:"bi bi-trash"},null,-1)]))])):h("",!0),e("div",{class:"cardVerticalCover backgroundCover mb-11 mb-md-0 me-md-11 rounded-2",style:X({backgroundImage:`url(${l.recipe.coverImgUrl})`})},null,4),e("div",Be,[e("div",De,[e("small",null,b($(oe)(l.categories,l.recipe.category)),1)]),e("h5",Ne,b(l.recipe.title),1),C(v,{to:`/user/${(y=l.recipe.user)==null?void 0:y._id}`,class:"link-muted d-block mb-6"},{default:g(()=>{var d;return[m(b((d=l.recipe.user)==null?void 0:d.nickName),1)]}),_:1},8,["to"]),e("p",Te,b(l.recipe.description),1),e("div",Ae,[l.mode==="edit"?(i(),U(v,{key:0,to:`/recipe-edit/${l.recipe._id}`,class:"btn btn-sm btn-outline-primary me-8 px-11"},{default:g(()=>s[6]||(s[6]=[m(" 編輯食譜 ")])),_:1},8,["to"])):h("",!0),C(v,{to:`/recipe/${l.recipe._id}`,class:"btn btn-sm btn-primary px-11"},{default:g(()=>s[7]||(s[7]=[m(" 查看更多 ")])),_:1},8,["to"])])])])}}},je={class:"row mb-17"},Oe={class:"col-12 py-8"},Ge={"aria-label":"breadcrumb"},qe={class:"breadcrumb"},ze={class:"breadcrumb-item"},Fe={class:"breadcrumb-item active","aria-current":"page"},Ee={class:"col-12 col-md-4 mb-16"},Qe={key:1,class:"userBannerAvatar d-flex justify-content-center align-items-center h-100 bg-dark-subtle rounded-2 shadow-sm text-white"},He={class:"col-12 col-md-8 mb-16"},Je={class:"position-relative p-14 p-lg-16 bg-white shadow-sm rounded"},Ke={class:"mb-11 text-center text-lg-start"},We={class:"textClamp textLs mb-11 text-center text-md-start text-muted"},Xe={class:"list-unstyled d-flex flex-column flex-md-row justify-contnet-center m-0 p-0 text-center"},Ye={class:"mb-8 mb-md-0 me-md-17 px-11 py-4 bg-light rounded-2 text-muted"},Ze={class:"d-block h3 mb-2 text-dark"},et={class:"mb-8 mb-md-0 me-md-17 px-11 py-4 bg-light rounded-2 text-muted"},tt={class:"d-block h3 mb-2 text-dark"},lt={class:"mb-8 mb-md-0 px-11 py-4 bg-light rounded-2 text-muted"},st={class:"d-block h3 mb-2 text-dark"},at={class:"col-12 col-xl-3"},ot={class:"sidebarTitle"},it={class:"sidebarList"},nt={key:0},dt={key:1},rt={class:"col-12 col-xl-9"},ct={class:"cardVerticalList"},ut={key:0,class:"d-flex justify-content-center align-items-center h-100 me-4"},mt={key:1,class:"mt-14"},ft={__name:"UserView",setup(l){const f=ce(),s=ge(),v=p(null),y=p(null),d=p({id:"",title:""}),r=ie(),j=ne(),O=de(),G=xe(),{openLoading:S,closeLoading:M}=r,{pushMessage:L}=j,{getTagsAndCategories:Y}=G,{toggleCollect:Z}=O,{myProfile:V}=H(O),{categories:q,tags:z}=H(G),B=p(""),c=p({}),D=p([]),N=p({}),k=p(!1),x=p("公開食譜");async function ee(){var a,t,o;S();try{if(k.value)c.value=V.value;else{const n=await be(B.value);c.value=n.data.data}}catch(n){L({style:"danger",title:"載入失敗",text:((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||"會員載入錯誤"}),(o=v.value)==null||o.openModal(),M()}}function T(a){x.value=a,P()}async function P(a=1){var t,o,n,R,I,F,E;S();try{let _=[];if(x.value==="我的收藏"){if(!k.value)return;_=await ve({page:a,perPage:5})}else if(x.value==="公開食譜")_=k.value?await K({isPublic:!0,page:a,perPage:5}):await pe(B.value,{isPublic:!0,page:a,perPage:5});else if(x.value==="私人食譜"){if(!k.value)return;_=await K({isPublic:!1,page:a,perPage:5})}D.value=(o=(t=_.data)==null?void 0:t.data)==null?void 0:o.results,N.value=(R=(n=_.data)==null?void 0:n.data)==null?void 0:R.pagination,M()}catch(_){L({style:"danger",title:"載入失敗",text:((F=(I=_.response)==null?void 0:I.data)==null?void 0:F.message)||"會員載入錯誤"}),(E=v.value)==null||E.openModal(),M()}}function te(){var a;(a=v.value)==null||a.hideModal(),s.push("/")}function le({recipeId:a,recipeTitle:t}){var o;d.value={id:a,title:t},(o=y.value)==null||o.openModal()}async function se(a){var t,o,n,R;S();try{await fe(a),P(),d.value={id:"",title:""},L({style:"success",title:"刪除食譜成功",text:"您已刪除食譜"}),(t=y.value)==null||t.hideModal(),M()}catch(I){console.log(I),L({style:"danger",title:"載入失敗",text:((n=(o=I.response)==null?void 0:o.data)==null?void 0:n.message)||"會員載入錯誤"}),(R=y.value)==null||R.hideModal(),M()}}return re(async()=>{var o;const{id:a}=f.params,{current:t}=f.query;a?(console.log("user id ",a),(!z.value.length||!q.value.length)&&await Y(),t&&(x.value=t==="我的收藏"?t:"公開食譜"),k.value=a===V.value._id,B.value=f.params.id,await ee(),await P()):(o=v.value)==null||o.openModal()}),(a,t)=>{const o=W("router-link");return i(),u(J,null,[e("div",je,[e("div",Oe,[e("nav",Ge,[e("ol",qe,[e("li",ze,[C(o,{to:"/"},{default:g(()=>t[3]||(t[3]=[m("首頁")])),_:1})]),e("li",Fe,b(c.value.nickName)+" 的個人頁面",1)])])]),e("div",Ee,[c.value.avatarImgUrl?(i(),u("div",{key:0,class:"userBannerAvatar backgroundCover h-100 bg-white rounded-2 shadow-sm",style:X({backgroundImage:`url(${c.value.avatarImgUrl})`})},null,4)):(i(),u("div",Qe,t[4]||(t[4]=[e("i",{class:"bi bi-person-fill"},null,-1)])))]),e("div",He,[e("div",Je,[k.value?(i(),U(o,{key:0,to:"/setting",class:"userBannerLink text-secondary fs-4"},{default:g(()=>t[5]||(t[5]=[e("i",{class:"bi bi-pencil-square"},null,-1)])),_:1})):h("",!0),e("h1",Ke,b(c.value.nickName),1),e("p",We,b(c.value.description?c.value.description:"尚未填寫"),1),e("ul",Xe,[e("li",Ye,[e("span",Ze,b(c.value.recipeCount?c.value.recipeCount:0),1),t[6]||(t[6]=m(" 擁有食譜 "))]),e("li",et,[e("span",tt,b($(ue)(c.value.createdAt)),1),t[7]||(t[7]=m(" 註冊天數 "))]),e("li",lt,[e("span",st,b(c.value.collectCount?c.value.collectCount:0),1),t[8]||(t[8]=m(" 收藏食譜 "))])])])]),e("div",at,[e("h5",ot,b(c.value.nickName)+" 的食譜",1),e("ul",it,[e("li",null,[e("a",{href:"#",class:A(["sidebarLink",{active:x.value=="公開食譜"}]),onClick:t[0]||(t[0]=w(n=>T("公開食譜"),["prevent"]))}," 公開食譜 ",2)]),k.value?(i(),u("li",nt,[e("a",{href:"#",class:A(["sidebarLink",{active:x.value=="私人食譜"}]),onClick:t[1]||(t[1]=w(n=>T("私人食譜"),["prevent"]))}," 私人食譜 ",2)])):h("",!0),k.value?(i(),u("li",dt,[e("a",{href:"#",class:A(["sidebarLink",{active:x.value=="我的收藏"}]),onClick:t[2]||(t[2]=w(n=>T("我的收藏"),["prevent"]))}," 我的收藏 ",2)])):h("",!0)])]),e("div",rt,[e("div",ct,[(i(!0),u(J,null,me(D.value,n=>(i(),U(Ue,{recipe:n,categories:$(q),tags:$(z),collects:$(V).collects,key:n._id,onToggleCollect:$(Z),mode:x.value!=="我的收藏"&&k.value?"edit":"collect",onOpenDelModal:le},null,8,["recipe","categories","tags","collects","onToggleCollect","mode"]))),128))]),D.value.length===0?(i(),u("div",ut,t[9]||(t[9]=[e("p",{class:"fs-3 text-dark-emphasis"},[e("em",null,"沒有符合條件的食譜")],-1)]))):h("",!0),N.value.totalPage?(i(),u("div",mt,[C(ke,{pagination:N.value,onUpdatePage:P},null,8,["pagination"])])):h("",!0)])]),C(ye,{ref_key:"alertModalRef",ref:v},{"modal-header":g(()=>t[10]||(t[10]=[e("span",{class:"titleIcon bg-danger-subtle"},[e("i",{class:"bi bi-exclamation-triangle-fill"})],-1),m(" 找不到此會員 ")])),"modal-content":g(()=>t[11]||(t[11]=[m(" 找不到此會員，將為您導入首頁 ")])),"modal-footer":g(()=>[e("button",{type:"button",class:"w-50 btn btn-primary",onClick:te},"關閉")]),_:1},512),C(Le,{ref_key:"delModalRef",ref:y,"del-id":d.value.id,onDelItem:se},{"modal-header":g(()=>t[12]||(t[12]=[m(" 刪除食譜 ")])),"modal-content":g(()=>[t[13]||(t[13]=m(" 確定要刪除 ")),e("strong",null," 食譜："+b(d.value.title),1)]),_:1},8,["del-id"])],64)}}};export{ft as default};
