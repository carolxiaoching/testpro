import{f as x,M as J,m as K,e as W,s as O,o as X,T as Y,k as n,n as e,p as m,w as p,i as ee,Q as se,S as z,A as c,z as G,R as l,q as r,F as b,N as y,Z as te,u as le,O as oe,l as i,_ as Q,$ as ne}from"./index-BcIb3MF0.js";import{t as ie}from"./tagAndCategoryStore-BbrOb6IB.js";import{_ as ae}from"./AlertModal-Doyk7bqK.js";import{_ as ce}from"./CardComponent-z2XL8TVG.js";const re={class:"row"},de={class:"col-12 py-8"},ue={"aria-label":"breadcrumb"},pe={class:"breadcrumb"},me={class:"breadcrumb-item"},be={class:"breadcrumb-item"},ge={class:"col-12 col-md-6 col-xl-7 mb-11 mb-md-16"},ve=["alt"],ye={class:"col-12 col-md-6 col-xl-5 mb-16"},_e={class:"position-relative p-16 bg-white shadow-sm rounded"},fe={class:"mb-11"},Re={class:"list-unstyled mb-11"},we={class:"mb-2"},xe={class:"mb-2"},he={class:"mb-2"},ke={class:"mb-2"},Ce={class:"textClamp textClampLg textLsSm text-muted"},$e={key:2,class:"list-unstyled mt-11 mb-0"},je={class:"badge text-bg-secondary fs-6"},Te={class:"col-12 col-lg-6 mb-16"},Ae={class:"title justify-content-start mb-11"},Fe={class:"fs-5 text-muted"},Ie={class:"row list-unstyled mb-0"},Me={class:"d-flex justify-content-between py-4 border-bottom"},Ne={class:"col-12 col-lg-6 mb-16"},Se={class:"row list-unstyled mb-0"},Le={class:"col-12 col-sm-6"},Be={class:"d-flex justify-content-between py-4 border-bottom"},Ve={class:"col-12 col-sm-6"},Oe={class:"d-flex justify-content-between py-4 border-bottom"},ze={class:"col-12 col-sm-6"},Ge={class:"d-flex justify-content-between py-4 border-bottom"},Qe={class:"col-12 col-sm-6"},qe={class:"d-flex justify-content-between py-4 border-bottom"},De={class:"col-12 col-sm-6"},Ee={class:"d-flex justify-content-between py-4 border-bottom"},Pe={class:"col-12 col-sm-6"},Ue={class:"d-flex justify-content-between py-4 border-bottom"},Ze={class:"col-12 mb-16"},He={class:"step mx-auto"},Je={class:"stepList list-unstyled position-relative m-0 p-0"},Ke={class:"stepOrder px-8 py-4 bg-secondary rounded-circle text-white fw-bold"},We={class:"ms-17 ms-md-23 p-11 bg-white rounded-2 shadow-sm"},Xe={class:"col-12 mb-16"},Ye={class:"textLsSm text-muted"},es={class:"col-12 mb-17"},ss={key:0,class:"row row-cols-1 row-cols-md-2 row-cols-xxl-3 gy-14 mb-11"},as={__name:"RecipeView",setup(ts){const q=Y(),h=le(),_=x(null),D=J(),E=K(),k=W(),C=ie(),{openLoading:$,closeLoading:g}=D,{pushMessage:j}=E,{getTagsAndCategories:P}=C,{toggleCollect:f}=k,{myProfile:T}=O(k),{categories:v,tags:A}=O(C),t=x({}),R=x([]);function U(){var a;(a=_.value)==null||a.hideModal(),h.push("/recipes")}async function Z(a){var s,d;console.log("open - getRecipe"),$("getRecipe");try{const u=await te(a);t.value=u.data.data,await H(t.value.category),console.log("close - getRecipe"),g("getRecipe")}catch(u){j({style:"danger",title:"載入失敗",text:((d=(s=u.response)==null?void 0:s.data)==null?void 0:d.message)||"食譜載入失敗，請重整網頁"}),console.log("close err - getRecipe"),g("err getRecipe"),h.push("/recipes")}}async function H(a){var s,d;console.log("open - getRelatedRecipes"),$("getRecipe");try{const u=await oe({category:a});R.value=u.data.data.results,console.log("close - getRelatedRecipes"),g("getRecipe")}catch(u){j({style:"danger",title:"載入失敗",text:((d=(s=u.response)==null?void 0:s.data)==null?void 0:d.message)||"相關食譜載入失敗，請重整網頁"}),console.log("close err - getRelatedRecipes"),g("err getRecipe")}}return X(async()=>{var s;const{id:a}=q.params;if(!a){(s=_.value)==null||s.openModal();return}(!A.value.length||!v.value.length)&&(console.log("開啟 - getTagsAndCategories"),await P(),console.log("關閉 - getTagsAndCategories")),console.log("開啟 - getRecipe"),await Z(a)}),(a,s)=>{var u,F,I,M,N,S,L,B,V;const d=ee("router-link");return i(),n(b,null,[e("div",re,[e("div",de,[e("nav",ue,[e("ol",pe,[e("li",me,[m(d,{to:"/recipes"},{default:p(()=>s[2]||(s[2]=[r(" 所有食譜 ")])),_:1})]),e("li",be,[m(d,{to:`/recipes?category=${t.value.category}`},{default:p(()=>[r(l(c(Q)(c(v),t.value.category)),1)]),_:1},8,["to"])]),s[3]||(s[3]=e("li",{class:"breadcrumb-item active","aria-current":"page"},"洋蔥炒牛肉",-1))])])]),e("div",ge,[e("div",{class:"recipeCover backgroundCover w-100 h-100 rounded-2",style:se({backgroundImage:`url(${t.value.coverImgUrl})`}),alt:t.value.title},null,12,ve)]),e("div",ye,[e("div",_e,[(u=c(T).collects)!=null&&u.includes(t.value._id)?(i(),n("a",{key:0,href:"#",class:"collectBtn position-absolute top-0 end-0 p-14 text-secondary fs-4",onClick:s[0]||(s[0]=G(o=>c(f)({active:"remove",recipeId:t.value._id}),["prevent"]))},s[4]||(s[4]=[e("i",{class:"bi bi-heart-fill"},null,-1)]))):(i(),n("a",{key:1,href:"#",class:"collectBtn position-absolute top-0 end-0 p-14 text-secondary fs-4",onClick:s[1]||(s[1]=G(o=>c(f)({active:"create",recipeId:t.value._id}),["prevent"]))},s[5]||(s[5]=[e("i",{class:"bi bi-heart"},null,-1)]))),m(d,{to:`/recipes?category=${t.value.category}`,class:"d-block mb-4"},{default:p(()=>[r(l(c(Q)(c(v),t.value.category)),1)]),_:1},8,["to"]),e("h1",fe,l(t.value.title),1),e("ul",Re,[e("li",we,[s[6]||(s[6]=e("i",{class:"bi bi-person-fill me-4"},null,-1)),s[7]||(s[7]=r(" 作者： ")),m(d,{to:`/user/${(F=t.value.user)==null?void 0:F._id}`,class:"link-muted"},{default:p(()=>{var o;return[r(l((o=t.value.user)==null?void 0:o.nickName),1)]}),_:1},8,["to"])]),e("li",xe,[s[8]||(s[8]=e("i",{class:"bi bi-calendar3 me-4"},null,-1)),r(" 建立日期："+l(a.$getTime(t.value.createdAt)),1)]),e("li",he,[s[9]||(s[9]=e("i",{class:"bi bi-calendar3 me-4"},null,-1)),r(" 更新日期："+l(a.$getTime(t.value.updatedAt)),1)]),e("li",ke,[s[10]||(s[10]=e("i",{class:"bi bi-bookmark-heart me-4"},null,-1)),r(" 收藏人數："+l(t.value.collectsCount),1)]),e("li",null,[s[11]||(s[11]=e("i",{class:"bi bi-clock-history me-4"},null,-1)),r(" 烹飪時長："+l(t.value.cookingTime),1)])]),e("p",Ce,l(t.value.description),1),(I=t.value.tags)!=null&&I.length?(i(),n("ul",$e,[(i(!0),n(b,null,y(t.value.tags,o=>(i(),n("li",{key:o,class:"d-inline-block me-2"},[e("span",je,l(c(ne)(c(A),o)),1)]))),128))])):z("",!0)])]),e("div",Te,[e("h2",Ae,[s[12]||(s[12]=e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-people-fill"})],-1)),s[13]||(s[13]=e("span",{class:"me-6"}," 食材 ",-1)),e("span",Fe,"("+l(t.value.servings)+" 人份)",1)]),e("ul",Ie,[(i(!0),n(b,null,y(t.value.ingredients,(o,w)=>(i(),n("li",{class:"col-12 col-sm-6",key:`ingredient${w}`},[e("p",Me,[e("span",null,l(o.ingredientName),1),e("span",null,l(o.ingredientQty),1)])]))),128))])]),e("div",Ne,[s[20]||(s[20]=e("h2",{class:"title justify-content-start mb-11"},[e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-people-fill"})]),e("span",null," 營養成分 ")],-1)),e("ul",Se,[e("li",Le,[e("p",Be,[s[14]||(s[14]=e("span",null," 總熱量 ",-1)),e("span",null,l((M=t.value.nutritionFacts)==null?void 0:M.calories)+" 大卡",1)])]),e("li",Ve,[e("p",Oe,[s[15]||(s[15]=e("span",null," 蛋白質 ",-1)),e("span",null,l((N=t.value.nutritionFacts)==null?void 0:N.protein)+" 克",1)])]),e("li",ze,[e("p",Ge,[s[16]||(s[16]=e("span",null," 碳水化合物 ",-1)),e("span",null,l((S=t.value.nutritionFacts)==null?void 0:S.totalCarb)+" 克",1)])]),e("li",Qe,[e("p",qe,[s[17]||(s[17]=e("span",null," 總脂肪 ",-1)),e("span",null,l((L=t.value.nutritionFacts)==null?void 0:L.totalFat)+" 克",1)])]),e("li",De,[e("p",Ee,[s[18]||(s[18]=e("span",null," 醣類 ",-1)),e("span",null,l((B=t.value.nutritionFacts)==null?void 0:B.sugar)+" 克",1)])]),e("li",Pe,[e("p",Ue,[s[19]||(s[19]=e("span",null," 鹽 ",-1)),e("span",null,l((V=t.value.nutritionFacts)==null?void 0:V.sodium)+" 克",1)])])])]),e("div",Ze,[s[21]||(s[21]=e("h2",{class:"title justify-content-start mb-11"},[e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-people-fill"})]),e("span",null," 步驟 ")],-1)),e("div",He,[e("ul",Je,[(i(!0),n(b,null,y(t.value.steps,(o,w)=>(i(),n("li",{class:"stepItem position-relative",key:`step${w}`},[e("div",Ke,l(o.stepOrder),1),e("div",We,l(o.stepContent),1)]))),128))])])]),e("div",Xe,[s[22]||(s[22]=e("h2",{class:"title justify-content-start mb-11"},[e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-people-fill"})]),e("span",null," 小撇步 ")],-1)),e("div",Ye,l(t.value.note||"無"),1)]),e("div",es,[s[23]||(s[23]=e("h2",{class:"title justify-content-start mb-11"},[e("span",{class:"titleIcon bg-secondary-subtle"},[e("i",{class:"bi bi-people-fill"})]),e("span",null," 更多料理選擇 ")],-1)),R.value.length?(i(),n("div",ss,[(i(!0),n(b,null,y(R.value.slice(0,3),o=>(i(),n("div",{class:"col",key:o._id},[m(ce,{recipe:o,categories:c(v),collects:c(T).collects,onToggleCollect:c(f)},null,8,["recipe","categories","collects","onToggleCollect"])]))),128))])):z("",!0)])]),m(ae,{ref_key:"alertModalRef",ref:_},{"modal-header":p(()=>s[24]||(s[24]=[e("span",{class:"titleIcon bg-danger-subtle"},[e("i",{class:"bi bi-exclamation-triangle-fill"})],-1),r(" 找不到此食譜 ")])),"modal-content":p(()=>s[25]||(s[25]=[r(" 找不到此食譜，將為您導入食譜列表頁面 ")])),"modal-footer":p(()=>[e("button",{type:"button",class:"w-50 btn btn-primary",onClick:U},"關閉")]),_:1},512)],64)}}};export{as as default};
