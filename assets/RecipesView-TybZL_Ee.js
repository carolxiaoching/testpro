import{M as U,m as G,e as H,s as A,f as k,E as I,k as n,n as s,q as u,v as J,x as Q,y as W,z as i,t as g,F as C,N as T,A as p,S as q,R as m,p as F,T as X,u as Y,l,O as Z}from"./index-CiKi2_ID.js";import{_ as ee}from"./CardComponent-C3zMLnhv.js";import{_ as se}from"./PaginationComponent-D7vq0Ivm.js";import{t as te}from"./tagAndCategoryStore-BnYkkddp.js";const ae={class:"py-17"},oe={class:"recipesBanner mx-auto mb-17 rounded-2"},ne={class:"recipesBannerOverLay d-flex justify-content-center align-items-center position-absolute top-0 bottom-0 start-0 end-0 p-8"},le={class:"recipesBannerContent text-center text-white"},re={class:"input-group"},ie={class:"row"},ce={class:"col-12 col-xl-3"},de={class:"sidebarList"},ue={class:""},ge=["onClick"],pe={class:"sidebarTags"},ye=["onClick"],ve={class:"col-12 col-xl-9 d-flex flex-column"},fe={class:"d-flex mb-14"},ke={key:0,class:"toolbarFilterText me-4"},me={key:1,class:"toolbarFilterTags"},be={class:"toolbarSort ms-auto"},_e={key:0,class:"flex-fill d-flex justify-content-center align-items-center me-4"},we={key:1,class:"row row-cols-1 row-cols-md-2 row-cols-xxl-3 gy-14 mb-11"},he={key:2,class:"mt-14"},Le={__name:"RecipesView",setup(xe){const c=X(),y=Y(),N=U(),M=G(),R=H(),L=te(),{openLoading:P,closeLoading:S}=N,{pushMessage:b}=M,{getTagsAndCategories:O}=L,{toggleCollect:j}=R,{myProfile:z}=A(R),{categories:_,tags:w}=A(L),v=k([]),h=k({}),o=k({sort:"desc",category:"全部",keyword:"",tags:[],page:1}),f=k("");function d(a){o.value={...o.value,...a},V()}I(()=>c.query,async a=>{if(a){(!w.value.length||!_.value.length)&&await O();const{keyword:e,category:t,tag:r}=c.query;(e||t||r)&&(o.value={sort:"desc",category:t||"全部",keyword:e||"",tags:r?[`${r}`]:[],page:1}),V()}},{immediate:!0});async function $(){c.query.keyword&&y.replace("/recipes");const e=f.value.trim();if(!e){b({style:"warning",title:"請輸入關鍵字",text:"請輸入關鍵字"});return}d({keyword:e,category:"全部",tags:[],page:1}),f.value=""}async function D(){c.query.keyword&&y.replace("/recipes"),d({keyword:"",category:"全部",tags:[],page:1})}function B(a){c.query.category&&y.replace("/recipes"),d({category:a})}function E(a){c.query.tag&&(o.value.tags=[],y.replace("/recipes"));const t=o.value.tags||[];if(t.length>=3&&!t.includes(a)){b({style:"warning",title:"標籤數量限制",text:"最多只能選擇3個標籤"});return}const r=t.indexOf(a);r>-1?t.splice(r,1):t.push(a),d({tags:t,page:1})}function x(a){d({sort:a,page:1})}function K(a){d({page:a})}async function V(){var a,e;P();try{const t=await Z(o.value);v.value=t.data.data.results,h.value=t.data.data.pagination,S()}catch(t){b({style:"danger",title:"取得食譜列表失敗",text:((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"請重整網頁再試一次"}),S()}}return(a,e)=>(l(),n("div",ae,[s("div",oe,[s("div",ne,[s("div",le,[e[5]||(e[5]=s("h2",{class:"recipesBannerTitle mb-14 lh-base"},[u(" 美味相伴 "),s("span",{class:"d-block"},"讓忙碌的生活更有滋味")],-1)),s("div",re,[J(s("input",{type:"text",class:"form-control",placeholder:"請輸入關鍵字","aria-label":"請輸入關鍵字","aria-describedby":"search","onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),onKeyup:W($,["enter"])},null,544),[[Q,f.value]]),s("button",{class:"btn btn-secondary",type:"button",id:"search",onClick:i($,["prevent"])}," 搜尋 ")])])])]),s("div",ie,[s("div",ce,[e[6]||(e[6]=s("h5",{class:"sidebarTitle"},"分類",-1)),s("ul",de,[s("li",ue,[s("a",{href:"#",class:g(["sidebarLink",{active:o.value.category=="全部"}]),onClick:e[1]||(e[1]=i(t=>B("全部"),["prevent"]))}," 全部 ",2)]),(l(!0),n(C,null,T(p(_),t=>(l(),n("li",{class:"",key:t._id},[s("a",{href:"#",class:g(["sidebarLink",{active:o.value.category==t._id}]),onClick:i(r=>B(t._id),["prevent"])},m(t.title),11,ge)]))),128))]),e[7]||(e[7]=s("h5",{class:"sidebarTitle"},[u(" 標籤 "),s("span",{class:"text-dark-emphasis fs-6"},"( 只能選3個 )")],-1)),s("ul",pe,[(l(!0),n(C,null,T(p(w),t=>(l(),n("li",{key:t._id},[s("a",{href:"#",class:g(["sidebarTagsLink",{sidebarTagsLinkActive:o.value.tags.includes(t._id)}]),onClick:i(r=>E(t._id),["prevent"])},m(t.title),11,ye)]))),128))])]),s("div",ve,[s("div",fe,[o.value.keyword!==""?(l(),n("div",ke,[s("a",{href:"#",class:"badge text-bg-primary fs-6",onClick:i(D,["prevent"])},[u(m(o.value.keyword)+" ",1),e[8]||(e[8]=s("i",{class:"bi bi-x"},null,-1))])])):q("",!0),o.value.keyword!==""?(l(),n("div",me," 共 "+m(v.value.length)+" 筆 ",1)):q("",!0),s("div",be,[s("a",{href:"#",class:g(["me-8",{"link-secondary":o.value.sort==="desc"}]),onClick:e[2]||(e[2]=i(t=>x("desc"),["prevent"]))},e[9]||(e[9]=[s("span",null,[s("i",{class:"bi bi-arrow-down"}),u(" 新到舊 ")],-1)]),2),s("a",{href:"#",class:g(["me-8",{"link-secondary":o.value.sort==="asc"}]),onClick:e[3]||(e[3]=i(t=>x("asc"),["prevent"]))},e[10]||(e[10]=[s("span",null,[s("i",{class:"bi bi-arrow-up"}),u(" 舊到新 ")],-1)]),2),s("a",{href:"#",class:g({"link-secondary":o.value.sort==="hot"}),onClick:e[4]||(e[4]=i(t=>x("hot"),["prevent"]))},e[11]||(e[11]=[s("span",null,[s("i",{class:"bi bi-fire"}),u(" 熱門度 ")],-1)]),2)])]),v.value.length===0?(l(),n("div",_e,e[12]||(e[12]=[s("p",{class:"fs-3 text-dark-emphasis"},[s("em",null,"沒有符合條件的食譜")],-1)]))):(l(),n("div",we,[(l(!0),n(C,null,T(v.value,t=>(l(),n("div",{class:"col",key:t._id},[F(ee,{recipe:t,categories:p(_),tags:p(w),collects:p(z).collects,onToggleCollect:p(j),mode:"collect"},null,8,["recipe","categories","tags","collects","onToggleCollect"])]))),128))])),h.value.totalPage?(l(),n("div",he,[F(se,{pagination:h.value,onUpdatePage:K},null,8,["pagination"])])):q("",!0)])])]))}};export{Le as default};
