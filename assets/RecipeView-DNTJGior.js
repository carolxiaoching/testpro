import{f as R,M as H,m as J,e as K,s as V,o as W,T as X,k as o,n as s,p as m,S as b,w as p,i as Y,Q as ss,A as a,z as G,R as l,q as c,F as y,N as f,Z as es,O as ts,u as ls,l as n,_ as O,$ as os}from"./index-CT1PSGs7.js";import{t as ns}from"./tagAndCategoryStore-D14jVr-r.js";import{_ as is}from"./AlertModal-C5vaSJ1A.js";import{_ as as}from"./CardComponent-goF_gLWs.js";const cs={class:"row"},rs={class:"col-12 py-8"},ds={"aria-label":"breadcrumb"},us={class:"breadcrumb"},ps={class:"breadcrumb-item"},ms={class:"breadcrumb-item"},bs={key:0,class:"col-12 col-md-6 col-xl-7 mb-11 mb-md-16"},gs=["alt"],vs={class:"col-12 col-md-6 col-xl-5 mb-16"},ys={class:"position-relative p-16 bg-white shadow-sm rounded"},_s={class:"mb-11"},fs={key:2,class:"list-unstyled mb-11"},ks={class:"mb-2"},ws={class:"mb-2"},xs={class:"mb-2"},hs={class:"mb-2"},Rs={class:"textClamp textClampLg textLsSm text-muted"},Cs={key:3,class:"list-unstyled mt-11 mb-0"},$s={class:"badge text-bg-secondary fs-6"},js={class:"col-12 col-lg-6 mb-16"},Ts={class:"title justify-content-start mb-11"},Is={class:"fs-5 text-muted"},As={key:0,class:"row list-unstyled mb-0"},Fs={class:"d-flex justify-content-between py-4 border-bottom"},Ms={class:"col-12 col-lg-6 mb-16"},Ns={class:"row list-unstyled mb-0"},Ss={class:"col-12 col-sm-6"},Ls={class:"d-flex justify-content-between py-4 border-bottom"},Bs={class:"col-12 col-sm-6"},Vs={class:"d-flex justify-content-between py-4 border-bottom"},Gs={class:"col-12 col-sm-6"},Os={class:"d-flex justify-content-between py-4 border-bottom"},zs={class:"col-12 col-sm-6"},Ds={class:"d-flex justify-content-between py-4 border-bottom"},Qs={class:"col-12 col-sm-6"},Us={class:"d-flex justify-content-between py-4 border-bottom"},qs={class:"col-12 col-sm-6"},Es={class:"d-flex justify-content-between py-4 border-bottom"},Ps={class:"col-12 mb-16"},Zs={class:"step mx-auto"},Hs={key:0,class:"stepList list-unstyled position-relative m-0 p-0"},Js={class:"stepOrder px-8 py-4 bg-secondary rounded-circle text-white fw-bold"},Ks={class:"ms-17 ms-md-23 p-11 bg-white rounded-2 shadow-sm"},Ws={class:"col-12 mb-16"},Xs={class:"textLsSm text-muted"},Ys={class:"col-12 mb-17"},se={key:0,class:"row row-cols-1 row-cols-md-2 row-cols-xxl-3 gy-14 mb-11"},ie={__name:"RecipeView",setup(ee){const z=X(),C=ls(),k=R(null),D=H(),Q=J(),$=K(),j=ns(),{openLoading:U,closeLoading:T}=D,{pushMessage:q}=Q,{getTagsAndCategories:E}=j,{toggleCollect:w}=$,{myProfile:I}=V($),{categories:_,tags:A}=V(j),t=R({}),x=R([]);function P(){var r;(r=k.value)==null||r.hideModal(),C.push("/recipes")}async function Z(r){var e,d;U("getRecipe"),console.log("問題 getRecipe");try{const u=await es(r);t.value=u.data.data;const g=t.value.category;console.log("apiGetRecipe 單一食譜成功, category 是 ",g);const v=await ts({category:g});console.log("resRecipes 結果 ",v),x.value=v.data.data.results,console.log("apiGetRecipes 關聯食譜成功"),T("getRecipe")}catch(u){q({style:"danger",title:"載入失敗",text:((d=(e=u.response)==null?void 0:e.data)==null?void 0:d.message)||"食譜載入失敗，請重整網頁"}),T("err getRecipe",u),C.push("/recipes")}}return W(async()=>{var e;const{id:r}=z.params;if(!r){(e=k.value)==null||e.openModal();return}(!A.value.length||!_.value.length)&&(console.log("開啟 - getTagsAndCategories"),await E(),console.log("關閉 - getTagsAndCategories")),console.log("開啟 - getRecipe"),await Z(r)}),(r,e)=>{var u,g,v,F,M,N,S,L,B;const d=Y("router-link");return n(),o(y,null,[s("div",cs,[s("div",rs,[s("nav",ds,[s("ol",us,[s("li",ps,[m(d,{to:"/recipes"},{default:p(()=>e[2]||(e[2]=[c(" 所有食譜 ")])),_:1})]),s("li",ms,[m(d,{to:`/recipes?category=${t.value.category}`},{default:p(()=>[c(l(a(O)(a(_),t.value.category)),1)]),_:1},8,["to"])]),e[3]||(e[3]=s("li",{class:"breadcrumb-item active","aria-current":"page"},"洋蔥炒牛肉",-1))])])]),t.value.coverImgUrl?(n(),o("div",bs,[s("div",{class:"recipeCover backgroundCover w-100 h-100 rounded-2",style:ss({backgroundImage:`url(${t.value.coverImgUrl})`}),alt:t.value.title},null,12,gs)])):b("",!0),s("div",vs,[s("div",ys,[(u=a(I).collects)!=null&&u.includes(t.value._id)?(n(),o("a",{key:0,href:"#",class:"collectBtn position-absolute top-0 end-0 p-14 text-secondary fs-4",onClick:e[0]||(e[0]=G(i=>a(w)({active:"remove",recipeId:t.value._id}),["prevent"]))},e[4]||(e[4]=[s("i",{class:"bi bi-heart-fill"},null,-1)]))):(n(),o("a",{key:1,href:"#",class:"collectBtn position-absolute top-0 end-0 p-14 text-secondary fs-4",onClick:e[1]||(e[1]=G(i=>a(w)({active:"create",recipeId:t.value._id}),["prevent"]))},e[5]||(e[5]=[s("i",{class:"bi bi-heart"},null,-1)]))),m(d,{to:`/recipes?category=${t.value.category}`,class:"d-block mb-4"},{default:p(()=>[c(l(a(O)(a(_),t.value.category)),1)]),_:1},8,["to"]),s("h1",_s,l(t.value.title),1),t.value._id?(n(),o("ul",fs,[s("li",ks,[e[6]||(e[6]=s("i",{class:"bi bi-person-fill me-4"},null,-1)),e[7]||(e[7]=c(" 作者： ")),m(d,{to:`/user/${(g=t.value.user)==null?void 0:g._id}`,class:"link-muted"},{default:p(()=>{var i;return[c(l((i=t.value.user)==null?void 0:i.nickName),1)]}),_:1},8,["to"])]),s("li",ws,[e[8]||(e[8]=s("i",{class:"bi bi-calendar3 me-4"},null,-1)),c(" 建立日期："+l(r.$getTime(t.value.createdAt)),1)]),s("li",xs,[e[9]||(e[9]=s("i",{class:"bi bi-calendar3 me-4"},null,-1)),c(" 更新日期："+l(r.$getTime(t.value.updatedAt)),1)]),s("li",hs,[e[10]||(e[10]=s("i",{class:"bi bi-bookmark-heart me-4"},null,-1)),c(" 收藏人數："+l(t.value.collectsCount),1)]),s("li",null,[e[11]||(e[11]=s("i",{class:"bi bi-clock-history me-4"},null,-1)),c(" 烹飪時長："+l(t.value.cookingTime),1)])])):b("",!0),s("p",Rs,l(t.value.description),1),(v=t.value.tags)!=null&&v.length?(n(),o("ul",Cs,[(n(!0),o(y,null,f(t.value.tags,i=>(n(),o("li",{key:i,class:"d-inline-block me-2"},[s("span",$s,l(a(os)(a(A),i)),1)]))),128))])):b("",!0)])]),s("div",js,[s("h2",Ts,[e[12]||(e[12]=s("span",{class:"titleIcon bg-secondary-subtle"},[s("i",{class:"bi bi-people-fill"})],-1)),e[13]||(e[13]=s("span",{class:"me-6"}," 食材 ",-1)),s("span",Is,"("+l(t.value.servings)+" 人份)",1)]),t.value._id?(n(),o("ul",As,[(n(!0),o(y,null,f(t.value.ingredients,(i,h)=>(n(),o("li",{class:"col-12 col-sm-6",key:`ingredient${h}`},[s("p",Fs,[s("span",null,l(i.ingredientName),1),s("span",null,l(i.ingredientQty),1)])]))),128))])):b("",!0)]),s("div",Ms,[e[20]||(e[20]=s("h2",{class:"title justify-content-start mb-11"},[s("span",{class:"titleIcon bg-secondary-subtle"},[s("i",{class:"bi bi-people-fill"})]),s("span",null," 營養成分 ")],-1)),s("ul",Ns,[s("li",Ss,[s("p",Ls,[e[14]||(e[14]=s("span",null," 總熱量 ",-1)),s("span",null,l((F=t.value.nutritionFacts)==null?void 0:F.calories)+" 大卡",1)])]),s("li",Bs,[s("p",Vs,[e[15]||(e[15]=s("span",null," 蛋白質 ",-1)),s("span",null,l((M=t.value.nutritionFacts)==null?void 0:M.protein)+" 克",1)])]),s("li",Gs,[s("p",Os,[e[16]||(e[16]=s("span",null," 碳水化合物 ",-1)),s("span",null,l((N=t.value.nutritionFacts)==null?void 0:N.totalCarb)+" 克",1)])]),s("li",zs,[s("p",Ds,[e[17]||(e[17]=s("span",null," 總脂肪 ",-1)),s("span",null,l((S=t.value.nutritionFacts)==null?void 0:S.totalFat)+" 克",1)])]),s("li",Qs,[s("p",Us,[e[18]||(e[18]=s("span",null," 醣類 ",-1)),s("span",null,l((L=t.value.nutritionFacts)==null?void 0:L.sugar)+" 克",1)])]),s("li",qs,[s("p",Es,[e[19]||(e[19]=s("span",null," 鹽 ",-1)),s("span",null,l((B=t.value.nutritionFacts)==null?void 0:B.sodium)+" 克",1)])])])]),s("div",Ps,[e[21]||(e[21]=s("h2",{class:"title justify-content-start mb-11"},[s("span",{class:"titleIcon bg-secondary-subtle"},[s("i",{class:"bi bi-people-fill"})]),s("span",null," 步驟 ")],-1)),s("div",Zs,[t.value._id?(n(),o("ul",Hs,[(n(!0),o(y,null,f(t.value.steps,(i,h)=>(n(),o("li",{class:"stepItem position-relative",key:`step${h}`},[s("div",Js,l(i.stepOrder),1),s("div",Ks,l(i.stepContent),1)]))),128))])):b("",!0)])]),s("div",Ws,[e[22]||(e[22]=s("h2",{class:"title justify-content-start mb-11"},[s("span",{class:"titleIcon bg-secondary-subtle"},[s("i",{class:"bi bi-people-fill"})]),s("span",null," 小撇步 ")],-1)),s("div",Xs,l(t.value.note||"無"),1)]),s("div",Ys,[e[23]||(e[23]=s("h2",{class:"title justify-content-start mb-11"},[s("span",{class:"titleIcon bg-secondary-subtle"},[s("i",{class:"bi bi-people-fill"})]),s("span",null," 更多料理選擇 ")],-1)),x.value.length?(n(),o("div",se,[(n(!0),o(y,null,f(x.value.slice(0,3),i=>(n(),o("div",{class:"col",key:i._id},[m(as,{recipe:i,categories:a(_),collects:a(I).collects,onToggleCollect:a(w)},null,8,["recipe","categories","collects","onToggleCollect"])]))),128))])):b("",!0)])]),m(is,{ref_key:"alertModalRef",ref:k},{"modal-header":p(()=>e[24]||(e[24]=[s("span",{class:"titleIcon bg-danger-subtle"},[s("i",{class:"bi bi-exclamation-triangle-fill"})],-1),c(" 找不到此食譜 ")])),"modal-content":p(()=>e[25]||(e[25]=[c(" 找不到此食譜，將為您導入食譜列表頁面 ")])),"modal-footer":p(()=>[s("button",{type:"button",class:"w-50 btn btn-primary",onClick:P},"關閉")]),_:1},512)],64)}}};export{ie as default};
